define(["angular"],function(e){return function(a,t,s,c){a.controller("messageCtrl",["$rootScope","$scope","cService","$cookieStore","G",function(a,t,s,c,n){"use strict";function o(){var a=[];return e.forEach(t.messageData,function(e,t){e.checked&&a.push(e.id)}),a}t.url="user/message",t.page=1,t.pageSize=10,t.getRows=function(e,a){s.ajax({url:t.url,method:"post",params:{page:e,rows:t.pageSize}}).success(function(e){t.messageData=e.rows,t.total=e.total,t.bAll=!1,n.updateMessageAmount()})},t.signRow=function(e){var a=o(),c="";switch(e){case 1:c="确定要将选中项删除吗？";break;case 2:c="确定将选中项标记为未读吗？";break;case 3:c="确定将选中项标记为已读吗？"}a.length>0?alert(c,{buttons:[{type:"submit",value:"确定",callBack:function(){s.ajax({url:t.url+"/"+a.join(",")+"/"+e,method:"get"}).success(function(e){t.getRows(t.page),t.bAll=!1})}},{type:"submit",value:"取消",className:"cancel"}]}):alert("至少选择一条消息")},t.expandRow=function(e,a){e.expand=a,a&&1==e.isReaded&&s.ajax({url:t.url+"/"+e.id}).success(function(a){e.content=a,e.isReaded=2,n.updateMessageAmount()})},t.checkedAll=function(a){e.forEach(t.messageData,function(e,t){e.checked=a}),t.bAll=a},t.getRows(1)}])}});