define(["angular"],function(e){return function(o,a,t,s){o.controller("accountSetCtrl",["$scope","$rootScope","$state","$window","cService","$cookieStore","$location",function(o,a,t,s,r,n,d){function i(e){var o,a;for(o=0,a="";e>o;o++)a+="*";return a}function l(e,o,a){var t;return t=e.substr(0,o),t+i(a)+e.substr(a+t.length)}function m(e){var o=e.indexOf("@");return str1=e.substr(0,o),l(str1,1,str1.length-2)+e.substr(o)}function u(e,o,a){e.setAttribute("disabled","true");var t=60;e.value="60秒后重新获取",e.style.background="#f8b651",a.key=setInterval(function(){t--,e.value=t+"秒后重新获取",0==t&&(clearInterval(a.key),e.value=o,e.removeAttribute("disabled"),e.style.background="#ff7d00")},1e3)}function c(e,o,a){clearInterval(a.key);var t=document.getElementById(e);t.value=o,t.removeAttribute("disabled"),t.style.background="#ff7d00"}o.MobileModify=!0,o.showPsw=!1,o.bindEma=!1,o.showEma=!1;var f=n.get("curUser");if(o.curUser=n.get("curUser"),o.email=f.email,void 0==o.email||""==o.email?o.isEmail=!1:o.isEmail=!0,o.isEmail&&(o.email=m(o.email)),f.realName){var p=f.realName.length,y=l(f.realName,1,p-1);o.idNo=y+"    "+f.idNo}o.phone=l(f.phone,3,4),1==a.user.realNameStatus?(o.idIdentify=1,o.score="100",o.grade="高",o.modifyMob=!1,document.getElementById("progress").style.backgroundPosition="0px -15px",document.getElementById("safety-color").style.color="#70bc31"):3==a.user.realNameStatus?(o.idIdentify=3,o.grade="中",o.score="75",o.modifyMob=!0,document.getElementById("progress").style.backgroundPosition="0px 0px",document.getElementById("safety-color").style.color="#f39800"):4==a.user.realNameStatus?(o.idIdentify=4,o.grade="中",o.score="75",o.modifyMob=!0,document.getElementById("progress").style.backgroundPosition="0px 0px",document.getElementById("safety-color").style.color="#f39800"):0==a.user.realNameStatus?(o.idIdentify=0,o.grade="中",o.score="75",o.modifyMob=!0,document.getElementById("progress").style.backgroundPosition="0px 0px",document.getElementById("safety-color").style.color="#f39800"):5==a.user.realNameStatus?(o.idIdentify=5,o.grade="中",o.score="75",o.modifyMob=!0,document.getElementById("progress").style.backgroundPosition="0px 0px",document.getElementById("safety-color").style.color="#f39800"):(o.idIdentify=2,o.grade="中",o.score="75",o.modifyMob=!0,document.getElementById("progress").style.backgroundPosition="0px 0px",document.getElementById("safety-color").style.color="#f39800");var g={key:""},v={key:""},b={key:""},h={key:""},E={key:""};o.formData={password:"",newPassword:""},o.formData1={validCode:""},o.formData2={email:"",validCode:""},o.formData3={validCode:"",phone:f.phone},o.formData4={validCode:"",phone:""},o.formData5={email:"",validCode:""},o.formData7={corpName:"",businessLicenceCode:""},o.getcodeMob1=function(){r.ajax({url:"users/sendPhoneCode",method:"post",params:{phone:f.phone}}).success(function(e){});var e=document.getElementById("getcodeMob1");u(e,"获取验证码",g)},o.submit1=function(e){e.$valid&&r.ajax({url:"users/phoneAuth",method:"post",params:o.formData3}).success(function(e,a){o.formData3={validCode:"",phone:""},o.MobileModify=!1,c("getcodeMob1","获取验证码",g)})},o.getcodeMob2=function(e){if(e.phone.$setViewValue(e.phone.$viewValue),e.phone.$valid){r.ajax({url:"users/sendPhoneCode",method:"post",params:{phone:o.formData4.phone}}).success(function(e){});var a=document.getElementById("getcodeMob2");u(a,"获取验证码",v)}},o.submit2=function(e){e.$valid&&r.ajax({url:"users/phoneModify",method:"post",params:o.formData4}).success(function(e,t){c("getcodeMob2","获取验证码",v),a.user.phone=o.formData4.phone,n.put("curUser",a.user),o.phone=l(o.formData4.phone,5,4),o.formData3.phone=o.formData4.phone,o.formData4={phone:"",validCode:""},o.MobileModify=!0,o.showMob=!1,confirm("手机号码修改成功！",{})})},o.submit3=function(a){if(a.$valid){var t=e.element(document.getElementById("password")),s=e.element(document.getElementById("passwordnew")),n=fieldRSA(t),d=fieldRSA(s);r.ajax({url:"users/updatePassword",method:"post",data:"password="+n+"&newPassword="+d}).success(function(e,a){o.formData={password:"",newPassword:""},o.newPsaaword2="",o.showPsw=!1,confirm("修改登录密码成功",{},2e3)})}},o.getcodeEma1=function(){r.ajax({url:"users/sendCheckCode",method:"post"}).success(function(e){});var e=document.getElementById("getcodeEma1");u(e,"发送验证邮件",b)},o.getcodeEma2=function(e){if(e.email.$setViewValue(e.email.$viewValue),e.email.$valid){r.ajax({url:"users/sendCheckCodeSecond",method:"post",data:"email="+o.formData2.email}).success(function(){});var a=document.getElementById("getcodeEma2");u(a,"发送验证邮件",h)}},o.submit4=function(e){e.$valid&&r.ajax({url:"users/checkCode",method:"post",data:"validCode="+o.formData1.validCode}).success(function(e,a){e&&(c("getcodeEma1","发送验证邮件",b),o.emailFir=!0,o.emailSec=!0,o.formData1={validCode:""})})},o.submit5=function(e){e.$valid&&r.ajax({url:"users/modifyEmail",params:o.formData2,method:"post"}).success(function(e,t){c("getcodeEma2","发送验证邮件",h),o.emailFir=!1,o.emailSec=!1,o.showEma=!1,a.user.email=o.formData2.email;var s=a.user;n.put("curUser",s),o.email=m(o.formData2.email),o.formData2={email:"",validCode:""},confirm("修改邮箱成功",{})})},o.getcodeEma3=function(e){if(e.email.$setViewValue(e.email.$viewValue),e.email.$valid){r.ajax({url:"users/sendBindCode",method:"post",data:"email="+o.formData5.email}).success(function(){});var a=document.getElementById("getcodeEma3");u(a,"发送验证邮件",E)}},o.submit6=function(e){e.$valid&&r.ajax({url:"users/emailAuth",params:o.formData5,method:"post"}).success(function(e,t){c("getcodeEma3","发送验证邮件",E),o.bindEma=!1,o.isEmail=!0,a.user.email=o.formData5.email,a.user.emailStatus=!0;var s=a.user;n.put("curUser",s),o.email=m(o.formData5.email),o.formData5={email:"",validCode:""},confirm("邮箱绑定成功",{})})},o.submit7=function(e){console.log(e.$valid);var a=s.open();e.$valid&&r.ajax({url:"/companyRegister",method:"post",params:o.formData7}).success(function(e,o){a.location=e,alert("请前往新打开窗口去完成开通企业借款，开通企业借款完成前不要关掉本窗口！",{buttons:[{type:"button",value:"开通成功",callBack:function(){window.location.reload()}},{type:"button",value:"开通失败",callBack:function(){window.location.reload()}}]})})}}])}});