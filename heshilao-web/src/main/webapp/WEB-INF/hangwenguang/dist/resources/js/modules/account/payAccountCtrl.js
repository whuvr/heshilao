define(["angular"],function(e){return function(e,o,n,t){e.controller("payAccountCtrl",["$scope","cService","$rootScope","$cookieStore","$interval","G","$window","$location","popupDialog",function(e,o,n,t,a,u,c,r,i){"use strict";e.formParams={idNo:n.user.idNo,realName:n.user.realName},e.url="account/paymentaccount";e.webName="",e.webPhone="",e.authorize={},o.ajax({url:"account/paymentaccount/getNamePhone"}).success(function(t,a,u,r){if("3"==n.corpInfo.tppType&&3==n.user.realNameStatus){alert("温馨提示：如您未开启投标授权、还款转账授权、二次分配审核授权，</br>请先至第三方页面开启授权；若您已开启授权，无需重复操作。",{closeBtn:!1,type:"info",buttons:[{type:"button",value:"去授权",callBack:function(){var e=c.open();o.ajax({url:"users/authSign",method:"get"}).success(function(o){e.location=o,alert("温馨提示：如您未开启投标授权、还款转账授权、二次分配审核授权，</br>请先至第三方页面开启授权；若您已开启授权，无需重复操作",{buttons:[{type:"button",value:"授权成功",callBack:function(){window.location.reload()}},{type:"button",value:"授权失败",callBack:function(){window.location.reload()}}]})}).error(function(){e.close()})}}]})}e.webName=t.webName,e.webPhone=t.webPhone}).error(function(e,o,n,t){window.location.reload()}),e.submit=function(a){o.ajax({url:e.url,method:"post",params:e.formParams}).success(function(){alert("绑定账号成功"),o.ajax({url:"users/userInfo",method:"get"}).success(function(e){n.user=e,t.put("curUser",e)}).error(function(){window.location.reload()})})},e.queryVerifyCode=function(){var n=e.form.phone;if(n.$setViewValue(n.$viewValue),!e.queried&&n.$valid){o.ajax({url:"account/paymentaccount/sendCode",method:"post",params:e.formParams}).success(function(e){}),e.queried=!0,e.queryAgainRemain=60;var t=a(function(){0==--e.queryAgainRemain&&(a.cancel(t),e.queried=!1)},1e3)}},e.getTppUrl=function(){var e=window.open("","newWindow");o.ajax({url:"account/paymentaccount/getTppUrl",method:"get"}).success(function(o){e.document.write(o)})}}])}});