define(["angular","configs/G"],function(e){return function(t){t.directive("rdFixed",["G",function(t){return{scope:{},link:function(n,i,o){function a(){l=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,l>c?f||(i.addClass("rd-fixed").css({left:s+"px",width:d+"px"}),f=!0):f&&(i.removeClass("rd-fixed").css({left:u,width:m}),i[0].style.left=null,i[0].style.width=null,f=!1)}var l,r=t.getElementAbsPos(i[0]),c=r.top,s=r.left,d=i[0].offsetWidth,u=t.GetCurrentStyle(i[0],"left"),m=t.GetCurrentStyle(i[0],"width"),f=!1;e.element(window).on("scroll",a),n.$on("$destroy",function(){e.element(window).off("scroll",a)})}}}]).directive("limitDecimal",[function(){return{require:"ngModel",link:function(e,t,n,i){var o=i.$name,a=e.$eval(n.limitDecimal),l=new RegExp("^[\\d]+\\.?[\\d]*$");rErrorDecimal=new RegExp("[\\d]+\\.[\\d]{"+(a+1)+",}"),okReg=new RegExp("[\\d]+\\.?[\\d]{"+a+","+a+"}"),e.$watch(o,function(t,n){t&&"string"==typeof t&&(!t.match(l)&&(e[o]=n),t.match(rErrorDecimal)&&(e[o]=t.match(okReg)[0]))})}}}]).directive("rdFly",["rdAnimate","$interval","G","$window",function(t,n,i,o){function a(e,t){e.moveTime=e.moveTime||1e3,e.delayTime=e.delayTime||3e3,e.moveName=void 0==e.moveName?"top":e.moveName,e.itemTag=e.itemTag||"li"}function l(o,a,l){function r(e){var n=f.children();d=o.moveDistance,h&&(d=m[0][0].offsetHeight),g&&(d=m[0][0].offsetWidth),t(a[0],o.moveName,-d*e,o.moveTime,function(){p=e}),n.removeClass("active"),n.eq(e).addClass("active")}function c(){n.cancel(o.timer),o.timer=n(function(){o.triggers?((0==p&&v||p==m.length-1&&!v)&&(v=!v),r(v?--p:++p)):(d=o.moveDistance,h&&(d=m[0][0].offsetHeight),g&&(d=m[0][0].offsetWidth),t(a[0],o.moveName,-d,o.moveTime,function(){m[0].parent().append(m[0]),a.css(o.moveName,"0px"),m.push(m.shift())}))},o.delayTime)}var s,d,u,m=[],f=e.element('<ul class="'+o.triggersClass+'"></ul>'),p=0,v=!1,h="top"==o.moveName||"bottom"==o.moveName,g="left"==o.moveName||"right"==o.moveName;"opacity"==o.moveName;a.css("position","relative"),e.forEach(a.find(o.itemTag),function(t,a){t=e.element(t),void 0!=t.attr("rd-fly-item")&&(m.push(t),o.triggers&&(s=e.element("<li></li>").on("mouseenter",function(){n.cancel(o.timer),targetIndex=i.index(this,f.children()),r(targetIndex)}).on("mouseleave",function(){c()}),f.append(s),1==f.children().length&&s.addClass("active")))}),m.length<=1||(g&&(u=m[0][0].offsetWidth,a.css("width",100*m.length+"%"),e.forEach(m,function(e,t){e.css("width",100/m.length+"%")})),o.triggers&&m.length>1&&(a.parent().append(f),f.css("margin-left",-f[0].offsetWidth/2+"px")),setTimeout(function(){(h&&a[0].offsetHeight>a.parent()[0].offsetHeight||g&&m.length>1)&&(c(),a.on("mouseenter",function(){n.cancel(o.timer)}).on("mouseleave",function(){c()}))},100))}function r(e,t,n){a(e,n),l(e,t,n)}return{scope:{moveTime:"@",delayTime:"@",moveName:"@",items:"=",itemTag:"@",triggers:"@",triggersClass:"@",moveDistance:"="},link:function(e,t,i){e.$watch("items",function(n,o){(o!=n||i.bIf)&&r(e,t,i)}),e.$on("$destroy",function(){n.cancel(e.timer)})}}}]).directive("multiLineTextOverflow",[function(){function t(t,n,i){var o,a,l,r=t.text,c=!1,s=t.$eval(i.multiLineTextOverflow);r&&(s<r.length?(n.html(""),o=r.substr(0,s)+"...",a=e.element("<span>"+o+"</span>"),l=e.element("<a>[展开]</a>").on("click",function(){c=!c,c?(l.text("[收缩]"),a.text(r)):(l.text("[展开]"),a.text(o))}),n.append(a),n.append(l)):n.text(r))}return{scope:{text:"="},link:function(e,n,i){e.$watch("text",function(){t(e,n,i)})}}}]).directive("countdown",["$interval","cService",function(e,t){return{link:function(t,n,i){function o(e){var t=parseInt(e/3600);e=parseInt(e%3600);var i=parseInt(e/60),o=e%60;n.html(t+" 时 "+i+" 分 "+o+" 秒 ")}var a,l;t.$watch(i.countdown,function(){a=t.$eval(i.countdown),o(a),a>0&&(l=e(function(n){if(a--,a>=0&&o(a),!a){e.cancel(l),l=void 0;try{t.$eval(i.countdown+"=0")}catch(r){}}},1e3))}),t.$on("$destroy",function(){e.cancel(l),l=void 0})}}}]).directive("iePlaceholder",["G",function(t){return{require:"ngModel",link:function(n,i,o,a){function l(){t.removeInlineStyle(i[0],["height","border-color","position","z-index"]),c.css("display","none"),i[0].focus()}function r(){i.css({height:"0px","border-color":"transparent",position:"absolute","z-index":-1}),c.css("display",""),i[0].blur()}var c,s=o.iePlaceholder,d=!1;a.$viewValue||i.val();i.parent().css({position:"relative"}),c=e.element(document.createElement("input")),c.val(s).css({color:"#999",display:"none"}),c.attr("class",i.attr("class")),c.attr("type","text"),i.parent().prepend(c);var u=(t.GetCurrentStyle(i[0],"height"),t.GetCurrentStyle(i[0],"border-left-color"),t.GetCurrentStyle(i[0],"position"),t.GetCurrentStyle(i[0],"zIndex"));(!u||0>u)&&(u=0),i.on("blur",function(e){i.val()||r(),d=!1}),i.on("keydown",function(e){d=!0}),c.on("focus",function(){i.attr("readonly",!1),l()}),n.$watch(a.$name,function(){a.$viewValue?(l(),!d&&i[0].blur()):d||r()})}}}]).directive("rdSelect",["$compile","G","$templateCache",function(t,n,i){function o(t,i,o){t.optionHandler=function(o){var a=e.element(o.target),l=a.text(),r=n.getIndex(a.parent()[0]);i[0].selectedIndex=r,t.$display.html(l),t.$content.css("display","none")},o.textField=o.textField||"text"}function a(n,o,a){if(n.$content.html(""),a.templateDiv){var l=e.element(i.get(a.templateDiv)).addClass("template-div");n.$content.append(t(l)(n.$parent)).css({overflow:"visible",border:"none"})}else{for(var r="<ul>",c=o.find("option"),s=0;s<c.length;s++){var d=c.eq(s),u=d.text();r+='<li><a class="option" ng-click="optionHandler($event)">'+u+"</a></li>","selected"!=d.attr("selected")&&0!=s||n.$display.html(u)}if(a.options){var m=n[a.options];if(m)for(var f=0;f<m.length;f++){var p=m[f],u=p[a.textField];r+='<li><a class="option" ng-click="optionHandler($event)">'+u+"</a></li>",0==f&&0==c.length&&n.$display.html(u)}}r+="</ul>",n.$content.append(t(r)(n))}}function l(n,i,o){function a(){d.css({display:"block"})}function l(){d.css({display:"none"})}var r=n.$wrap=i.wrap('<div class="rd-select" style="position:relative;overflow:visible;"></div>').parent().addClass(i.attr("class")),c=n.$display=e.element('<div class="display"></div>');o.placeholder&&c.html(o.placeholder);var s=n.$trigger=e.element('<a class="trigger" tabindex="-1"></a>'),d=n.$content=e.element('<div class="content" style="display:none;position:absolute;top:100%;left:-1px;width:100%;"></div>'),u=!0;r.on("click",function(){a()}),r.on("mouseenter",function(){u=!1}).on("mouseleave",function(){u=!0}),e.element(document).on("click",function(e){u&&l()}),r.append(t(c)(n)),r.append(t(s)(n)),r.append(t(d)(n))}return{scope:{dyPlaceholder:"="},transclude:!0,link:function(e,t,n){t.css({display:"none"}),o(e,t,n),l(e,t,n),e.$watch(n.options,function(){a(e,t,n)}),e.$watch("dyPlaceholder",function(){e.$display&&e.$display.html(e.dyPlaceholder)})}}}]).factory("popupDialog",["$compile","$templateCache",function(t,n){return function(i,o,a,l){var i=i?n.get(i):"<div></div>",r=e.extend({wait:!0,type:"no-icon"},a||{});r.wait&&(o.alert_wait=!0,i='<i ng-show="alert_wait">loading...</i><div ng-show="!alert_wait">'+i+"</div>");var c=t(i)(o),s=alert('<div id="popupDialog" class="'+r.wrapClass+'"></div>',r,l),d=e.element(document.getElementById("popupDialog")).append(c);return r.css&&d.css(r.css),"function"==typeof r.ajax?r.ajax.call(d).then(function(){o.alert_wait=!1,d.css("display","none").css("display","block")},function(){s.close(s)}):o.alert_wait=!1,s}}]).filter("html",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]).filter("synomymous",function(){return function(e){for(var t="",n=0;n<e.length;n++)t+=0==n?e.charAt(n):"*";return t}}).filter("decimal",function(){return function(e,t){return e.toFixed(t)}}).filter("million",["$filter",function(e){return function(t,n,i){var o="万";return void 0==n&&(n=1e5),void 0==i&&(i=2),t>=n?e("number")(t/1e4,0)+o:e("number")(t,i)}}]).service("rdAnimate",["G",function(e){return function(t,n,i,o,a){function l(){clearInterval(t.timer),t.timer=null,c?e.isIE8()?t.style.filter="alpha(opacity="+(s+r)+")":t.style[n]=s+r:t.style[n]=s+r+"px","function"==typeof a&&a()}var r,c="opacity"==n,s=parseFloat(e.GetCurrentStyle(t,n)),d=o/20,u=0;!s&&(s=0),c&&e.isIE8()&&!s&&(s=100),c&&!e.isIE8()&&(i/=100),r=i-s,t.timer&&(clearInterval(t.timer),t.timer=null),t.timer=setInterval(function(){u++,c?e.isIE8()?t.style.filter="alpha(opacity="+(s+r*u/d)+")":t.style[n]=s+r*u/d:t.style[n]=s+r*u/d+"px",u>=d&&t.timer&&l()},5)}}]).directive("rdShow",["G",function(e){return{link:function(e,t,n){e.$watch(n.rdShow,function(){var i=e.$eval(n.rdShow);i?t.css("display","block"):t.css("display","none")})}}}]).directive("compareTo",function(){return{require:"ngModel",link:function(e,t,n,i){var o;e.$watch(n.compareTo,function(){o&&i.$setViewValue(o)}),i.$parsers.push(function(t){i.$setValidity("repeat",t==e.$eval(n.compareTo)),o=t})}}}).directive("dymin",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){e.$watch(n.dyMin,function(){i.$viewValue||0==i.$viewValue&&i.$setViewValue(i.$viewValue)});var o=function(t){var o=e.$eval(n.dymin);return o>t?void i.$setValidity("dymin",!1):(i.$setValidity("dymin",!0),t)};i.$parsers.push(o),i.$formatters.push(o)}}}).directive("dymax",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){e.$watch(n.dyMax,function(){i.$viewValue||0==i.$viewValue&&i.$setViewValue(i.$viewValue)});var o=function(t){var o=e.$eval(n.dymax);return t>o?void i.$setValidity("dymax",!1):(i.$setValidity("dymax",!0),t)};i.$parsers.push(o),i.$formatters.push(o)}}}).directive("tabs",["$parse",function(t){return{link:function(n,i,o){function a(){var e=n.$eval(o.initializeIndex);e||(e=0),l.removeClass("active"),r.css({display:"none"}),l.eq(e).addClass("active"),r.eq(e).css({display:"block"})}var l=i.children().eq(0).find("a"),r=i.children().eq(1).children();return n.$watch(o.initializeIndex,function(){a()}),l.length<=1?void l.css("cursor","default"):void l.on("click",function(){var i=e.element(this),a=i.attr("tab-index");if(void 0==a){for(var c=this,s=0;null!=(c=c.previousSibling);)1==c.nodeType&&s++;a=s}o.switchAction&&(t(o.switchAction)(n,{index:a,value:this.value}),n.$apply()),l.removeClass("active"),r.css({display:"none"}),i.addClass("active"),r.eq(a).css({display:"block"})})}}}]).directive("rdImagePreview",function(){return{scope:{src:"@rdImagePreview",imageWidth:"@",imageHeight:"@"},link:function(t,n,i){var o,a,l,r=t.src,c=parseInt(t.imageWidth)?t.imageWidth:800,s=parseInt(t.imageHeight)?t.imageHeight:600;n.on("click",function(){a=e.element(document.body),o=e.element('<div class="rd-image-preview-conta"><img src="'+r.replace(/w\/[\d]+\/h\/[\d]+$/,"w/"+c+"/h/"+s)+'" /></div>'),l=e.element('<div class="rd-mask"></div>').off("click").on("click",function(){l.remove(),o.remove()}),a.append(l),a.append(o)})}}}).directive("rdImagesPreview",function(){function t(t,n,i){function o(){c&&(c.remove(),l.remove(),c=null)}function a(t,n){r=e.element(document.body),l=e.element('<div class="rd-image-preview-conta"><img src="'+t.attr("src").replace(/w\/[\d]+\/h\/[\d]+$/,"w/"+m+"/h/"+f)+'" /></div>'),c=e.element('<div class="rd-mask"></div>').off("click").on("click",function(){o()}),s=e.element('<a class="prev-btn"></a>').on("click",function(){n>0&&(o(),a(e.element(u[n-1]),n-1))}),d=e.element('<a class="next-btn"></a>').on("click",function(){n<u.length-1&&(o(),a(e.element(u[n+1]),n+1))}),n>0&&l.append(s),n<u.length-1&&l.append(d),r.append(c),r.append(l)}var l,r,c,s,d,u,m=(t.src,parseInt(t.imageWidth)?t.imageWidth:800),f=parseInt(t.imageHeight)?t.imageHeight:600;u=n.find("img"),e.forEach(u,function(t,n){t=e.element(t),t.on("click",function(){a(t,n)})})}return{scope:{items:"=",imageWidth:"@",imageHeight:"@"},link:function(e,n,i){e.$watch("items",function(){"object"==typeof e.items&&e.items.length&&t(e,n,i)})}}})}});