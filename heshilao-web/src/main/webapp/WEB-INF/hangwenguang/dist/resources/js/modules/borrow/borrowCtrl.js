define(["angular"],function(e){return function(e,t,o,r){e.controller("borrowCtrl",["$scope","cService","$state","$cookieStore","$interval",function(e,t,o,r,a){function d(){var t;e.countdown<=0||(t=a(function(){e.countdown--,r.put("inv-req-valid-code-countdown",e.countdown),e.countdown<=0&&a.cancel(t)},1e3))}e.formData={borrowType:"0",companyName:"",linkman:"",linkmanPhone:"",amountBorrow:"",timeType:"0",timeLimit:"",province:"北京",city:"海淀区",validCode:"",imageCode:""},e.fieldSNStart,r.put("inv-req-valid-code-countdown",0),e.countdown=r.get("inv-req-valid-code-countdown")||0,d(),e.getCode=function(){var o=e.form.phone;o.$setViewValue(o.$viewValue),o.$valid&&t.ajax({url:"borrows/sendCode",params:{phone:e.formData.linkmanPhone,imageCode:e.formData.imageCode}}).success(function(t){i.setAttribute("disabled","disabled"),i.setAttribute("class","register-getcode  disabled"),i.value="60秒后重新获取",i.setAttribute("disabled",!0),n=!0,e.countdown=60,d()}).error(function(t){i.setAttribute("disabled","disabled"),i.setAttribute("class","register-getcode  disabled"),"3005"==t.code&&(e.callError=t.message,e.serverError=!0)})},e.submit=function(r){r.$valid&&t.ajax({method:"post",url:"borrows/borrowApply",params:e.formData}).success(function(e){alert("您好！您的借款申请已成功提交，请耐心等待业务人员联系您!",{closeBtn:!1,buttons:[{type:"button",value:"确定",callBack:function(){o.go("home")}}]})})},e.switchAction=function(t,o){e.fieldSNStart=-t};var d,i=document.getElementById("getCode"),n=!1;e.$on("$viewContentLoaded",function(){i=document.getElementById("getCode")}),e.validImg=function(){var o=0;e.formData.imageCode&&(o=e.formData.imageCode.length),e.serverError=!1,i.setAttribute("disabled","disabled"),i.setAttribute("class","register-getcode  disabled"),o>=4&&t.ajax({url:"users/checkImageCode",method:"post",params:{imageCode:e.formData.imageCode}}).success(function(e){""==e&&0==n?(i.removeAttribute("disabled"),i.setAttribute("class","register-getcode")):(i.setAttribute("disabled","disabled"),i.setAttribute("class","register-getcode  disabled"))}).error(function(t,o,r,a){i.setAttribute("disabled","disabled"),i.setAttribute("class","register-getcode  disabled"),"3005"==t.code&&(e.callError=t.message,e.serverError=!0)})},e.valid="validCode?t="+Math.random(),e.validCode=function(){e.valid="validCode?t="+Math.random()},e.gotoAnchor=t.gotoAnchor}])}});