define(["angular"],function(e){return function(t,r,o,a){t.controller("registerCtrl",["$scope","$rootScope","$state","$window","cService","$location","popupDialog","$cookieStore",function(t,r,o,a,n,s,d,l){t.emailbox=!1,t.formData={username:"",phone:"",password:"",isAgree:"",validCode:"",userInviteCode:""},t.$parent.formData1={phone:"",username:""};var u=window.location.hash;u.indexOf("ui")>0&&(t.formData.userInviteCode=u.substr(u.indexOf("=")+1)),t.serverError=!1,t.callError="",t.hideError=function(){t.serverError=!1},t.validImg=function(){var e=t.formData.imgCode.length;t.serverError=!1,e>=4&&n.ajax({url:"users/checkImageCode",method:"post",params:{imageCode:t.formData.imgCode}}).success(function(e){var t=document.getElementById("getcode");""==e?(t.removeAttribute("disabled"),t.setAttribute("class","register-getcode")):(t.setAttribute("disabled","disabled"),t.setAttribute("class","register-getcode  disabled"))}).error(function(e,r,o,a){"3005"==e.code&&(t.callError=e.message,t.serverError=!0)})},t.valid="validCode?t="+Math.random(),t.validCode=function(){t.valid="validCode?t="+Math.random()},t.userProtocol=function(){n.ajax({url:"users/getRegisterProtocolContext",method:"get"}).success(function(e){alert('<div style="height:450px;width:800px;overflow-y:scroll;text-align:left">'+e+"</div>",{title:'<h1 id="register-protocol-title">协议内容</h1>',buttons:[],type:"no-icon"})})},t.getCode=function(e){var r=e.phone;r.$setViewValue(r.$viewValue);var o;if(r.$valid){n.ajax({url:"users/sendCode",method:"post",params:{phone:t.formData.phone}}).success(function(e){});var a=document.getElementById("getcode");a.value="60秒后重新获取",a.setAttribute("disabled",!0);var i=59;o=setInterval(function(){0==i?(clearInterval(o),a.value="获取验证码",a.removeAttribute("disabled")):(a.value=i+"秒后重新获取",i--)},1e3)}},t.submit=function(o,a){var s=document.getElementById("register_button");if(s.setAttribute("disabled",!0),13==a.keyCode)return a.keyCode=0,!1;if(o.$valid){""==t.formData.userInviteCode&&delete t.formData.userInviteCode,t.formData_encryption={};var d=e.element(document.getElementById("password")),u=fieldRSA(d);for(i in t.formData)t.formData_encryption[i]=t.formData[i];t.formData_encryption.password=u,console.log(t.formData_encryption),n.ajax({url:"users/register",method:"post",params:t.formData_encryption}).success(function(e){r.user=e,l.put("curUser",e),r.login={beforeLogin:!1,afterLogin:!0},s.removeAttribute("disabled"),t.$parent.formData1.email=t.formData.email,t.$parent.formData1.username=t.formData.username,t.formData={username:"",phone:"",password:"",isAgree:1,validCode:"",userInviteCode:""},t.confirmPassword="",window.location.href="#/register/activateEmailSucc"}).error(function(e){s.removeAttribute("disabled")})}return!1}}]),t.directive("ngTipbox",function(){return{restrict:"A",template:'<div id="tipBox"><p id="tipContent"></p><p id="tipArrow"></p></div>',link:function(e,t,r,o){t.css("display","none"),t.children().children()[0].innerHTML=r.ngTipbox;var a=t.parent().find("input");a.on("focus",function(){t.css("display","block")}),a.on("blur",function(){t.css("display","none")})}}})}});