define(["angular"],function(e){return function(t,a,n,o){t.controller("rechargeCtrl",["$scope","httpService","$http","cService","$window","$state","$cookieStore","$timeout","$location","popupDialog",function(t,a,n,o,c,r,l,u,i,s){"use strict";var d=l.get("curUser");t.corpBank=2,t.tab={on0:!0},t.bankList=[],t.innerData=[],t.isBank=!1,t.pageSize=5,t.page=1,t.bankKind="储蓄卡",t.formData={cashStr:"",rechargeType:"1"},t.formData1={cashStr:"",rechargeType:"0",bankCode:"",bankName:""},t.checkBank=function(e){t.formData.id=t.bankList[e].id;for(var a=t.bankList.length,n=0;a>n;n++)t.tab["on"+n]=!1;t.tab["on"+e]=!0},t.pageSerch=function(e){a.get({url:"account/recharge/rechargeList",params:{page:e,rows:5}}).success(function(e,a,n,o){t.innerData=e.rows,t.total=e.total})},t.pageSerch(1),t.rechargeAmount=function(){var a=e.element(document.getElementById("recharge-input1")),n=fieldRSA(a);t.formData1.cashStr=n},t.submitForm=function(a){var n=document.getElementById("recharge_sel"),o=n.selectedIndex;if(o>=0&&(t.formData1.bankName=n.options[o].innerHTML,t.formData1.bankCode=n.options[o].value),a.$valid){var c=e.element(document.getElementById("recharge-input1")),r=fieldRSA(c);t.formData1.cash="",c.val(""),t.formData1.cashStr=r,alert("请前往新打开窗口去完成充值操作，充值完成前不要关掉本窗口！",{buttons:[{type:"button",value:"充值成功",callBack:function(){window.location.reload()}},{type:"button",value:"充值失败",callBack:function(){window.location.reload()}}]})}},3==d.realNameStatus?alert("温馨提示：如您未开启投标授权、还款转账授权、二次分配审核授权，</br>请先至第三方页面开启授权；若您已开启授权，无需重复操作。",{closeBtn:!1,type:"info",buttons:[{type:"button",value:"去授权",callBack:function(){var e=c.open();o.ajax({url:"users/authSign",method:"get"}).success(function(t){e.location=t,alert("温馨提示：如您未开启投标授权、还款转账授权、二次分配审核授权，</br>请先至第三方页面开启授权；若您已开启授权，无需重复操作",{buttons:[{type:"button",value:"授权成功",callBack:function(){window.location.reload()}},{type:"button",value:"授权失败",callBack:function(){window.location.reload()}}]})}).error(function(){e.close()})}}]}):0==d.userType?0==d.realNameStatus?alert("您尚未实名认证，请先去实名认证",{closeBtn:!1,buttons:[{type:"button",value:"去实名认证",callBack:function(){r.go("account.payAccount")}}]}):a.get({url:"account/recharge/getBank"}).success(function(e,a,n,o){t.bankList=e.bankList,e.bankList.length>0&&(t.formData.id=e.bankList[0].id)}):1!=d.userType&&2!=d.userType||(5==d.realNameStatus?alert("请等待平台运营人员进行企业信息核实",{closeBtn:!0}):(t.isBank=!0,t.corp=!0)),a.get({url:"account/recharge/getToken"}).success(function(e,a,n,o){t.token=e});var g;a.get({url:"account/recharge/getRechargeInfo"}).success(function(e,a,n,o){t.balance=e.balanceAvailable,t.minRechargeAmount=e.minRechargeAmount,g=e.canFastRecharge,1==d.realNameStatus&&0==g&&(t.rechargeType=function(){2==t.formData1.rechargeType&&alert("请先绑定具有快捷支付功能的银行卡",{closeBtn:!1,buttons:[{type:"button",value:"去绑定银行卡",callBack:function(){r.go("account.bankCard")}}]})})});var p;p=a.get({url:"account/recharge/getRechargeBanksB2B"}),p.success(function(e){p=e;for(var t=document.getElementById("recharge_sel"),a=0;a<e.length;a++){(1!=d.userType&&2!=d.userType||"bank_type_b2b"!=e[a].typeCode)&&t.options.add(new Option(e[a].dictValue,e[a].dictCode))}}),t.changeCorpBank=function(){var e=document.getElementById("recharge_sel"),t=document.getElementById("recharge_corp").value,a=document.getElementById("bank-card-list");if(e.innerHTML="",2==t?(a.style.display="none",1!=d.realNameStatus&&0==g&&alert("您尚未开通快捷支付，请先去开通",{closeBtn:!1,buttons:[{type:"button",value:"开通快捷支付",callBack:function(){r.go("account.bankCard")}}]})):a.style.display="block",0==t)for(var n=0;n<p.length;n++){"bank_type_b2c"==p[n].typeCode&&e.options.add(new Option(p[n].dictValue,p[n].dictCode))}else if(4==t)for(var n=0;n<p.length;n++){"bank_type_b2b"==p[n].typeCode&&e.options.add(new Option(p[n].dictValue,p[n].dictCode))}}}])}});